import Vue from"vue";let data={grabElement:null,moveElement:null,axis:"all",isStyleAdded:!1,transform:{declared:!1,string:""},initialX:0,initialY:0,cursorInitialX:0,cursorInitialY:0},stylesheet=".drag-draggable { position: relative; } .drag-draggable:not(.drag-uses-handle), .drag-handle { cursor: move; cursor: grab; cursor: -webkit-grab; cursor: -moz-grab; } .drag-handle.drag-down, .drag-draggable:not(.drag-uses-handle).drag-down { z-index: 999; cursor: grabbing; cursor: -webkit-grabbing; cursor: -moz-grabbing; }";function returnPositionString(c,d){return`matrix(${data.transform.string} ${c}, ${d})`}function dragDown(c,d,f,g){data.grabElement=d,data.moveElement=f,data.axis=c||"all",data.cursorInitialX=g.pageX||g.touches[0].pageX,data.cursorInitialY=g.pageY||g.touches[0].pageY,data.initialX=+window.getComputedStyle(f).left.replace("px",""),data.initialY=+window.getComputedStyle(f).top.replace("px",""),data.relativeX=0,data.relativeY=0;let h=window.getComputedStyle(f).transform;"none"==h?(data.transform.declared=!1,data.transform.string="1, 0, 0, 1,"):(data.transform.declared=!0,data.transform.string=h.match(/\d([^,]*,){4}/g)[0]),f.style.transform=returnPositionString(data.initialX,data.initialY),f.style.left=0,f.style.top=0,d.classList.add("drag-down"),document.addEventListener("mousemove",updatePosition),document.addEventListener("touchmove",updatePosition)}function updatePosition(c){let d=(c.pageX||c.touches[0].pageX)-data.cursorInitialX,f=(c.pageY||c.touches[0].pageY)-data.cursorInitialY;data.moveElement.classList.add("drag-move"),"x"==data.axis?f=0:"y"==data.axis&&(d=0),data.moveElement.style.transform=returnPositionString(data.initialX+d,data.initialY+f),data.relativeX=d,data.relativeY=f}function dragUp(){data.moveElement&&(data.moveElement.style.transform=data.transform.declared?returnPositionString(0,0):"none",data.moveElement.style.left=data.initialX+data.relativeX+"px",data.moveElement.style.top=data.initialY+data.relativeY+"px",data.grabElement.classList.remove("drag-down"),data.moveElement.classList.remove("drag-move"),document.removeEventListener("mousemove",updatePosition),document.removeEventListener("touchmove",updatePosition))}export default Vue.directive("drag",{inserted:function(c,d){let g=d.value,h,i,j,k;if(!data.isStyleAdded){data.isStyleAdded=!0;let m=document.createElement("style");m.innerHTML=stylesheet,document.body.appendChild(m)}"object"==typeof g?(h=g.axis,i=g.handle):(h=d.arg,i=g);let l=document.getElementById(i);g&&!l&&g.handle?console.error(`Element with id “${g.handle||g}” doesn’t exist`):(l?(j=l,k=c,k.classList.add("drag-uses-handle"),j.classList.add("drag-handle")):(j=c,k=c),k.classList.add("drag-draggable"),j.addEventListener("mousedown",m=>dragDown(h,j,k,m)),j.addEventListener("touchstart",m=>dragDown(h,j,k,m))),document.addEventListener("mouseup",dragUp),document.addEventListener("touchend",dragUp)}});
